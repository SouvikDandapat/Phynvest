<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Professional Finance Portfolio Dashboard</title>

<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>

<style>
body{
  font-family:'Inter',sans-serif;
  background:#F9FAFB;
  color:#1e293b;
}
.finance-card{
  background:#ffffff;
  border:1px solid #e2e8f0;
  border-radius:1rem;
  box-shadow:0 4px 6px rgba(0,0,0,0.05);
}
.text-emerald-custom{ color:#059669; }
.bg-emerald-custom{ background-color:#10b981; }
</style>
</head>

<body class="p-4 md:p-8">

<main class="max-w-7xl mx-auto space-y-6">

<header class="flex flex-col md:flex-row md:items-end justify-between gap-4 mb-8">
<div>
<h1 class="text-3xl font-bold">Investment Portfolio</h1>
<p class="text-slate-400 mt-1">Real-time performance and asset tracking</p>
</div>

<div class="finance-card p-6 flex gap-8 items-center">
<div>
<p class="text-sm uppercase font-semibold text-slate-500">Total Balance</p>
<div class="flex items-baseline gap-2">
<span class="text-4xl font-bold">$700</span>
<span class="text-emerald-custom font-medium">â–² 12.4%</span>
</div>
</div>
</div>
</header>

<section class="grid grid-cols-1 lg:grid-cols-3 gap-6">

<div class="lg:col-span-2 finance-card p-6 min-h-[400px]">
<h2 class="text-lg font-semibold mb-4">Performance Growth</h2>
<canvas id="performanceChart"></canvas>
</div>

<div class="finance-card p-6">
<h2 class="text-lg font-semibold mb-4">Asset Allocation</h2>
<canvas id="allocationChart"></canvas>

<ul class="mt-6 space-y-2 text-sm">
<li class="flex justify-between"><span>TCS</span><span>55%</span></li>
<li class="flex justify-between"><span>HDFC BANK</span><span>25%</span></li>
<li class="flex justify-between"><span>RELIANCE</span><span>12%</span></li>
</ul>
</div>

</section>

<section class="finance-card overflow-hidden">
<div class="p-6 border-b flex justify-between items-center">
<h2 class="text-lg font-semibold">AI Portfolio Analysis</h2>
<button onclick="fetchPortfolioAnalysis()" class="text-emerald-custom text-sm font-medium hover:underline">
Refresh
</button>
</div>

<div id="aiPredictionResult" class="p-6 text-sm text-slate-700">
Loading AI prediction...
</div>
</section>

</main>

<script>
// ===============================
// PERFORMANCE CHART
// ===============================
const ctxPerformance = document.getElementById('performanceChart').getContext('2d');

new Chart(ctxPerformance,{
type:'line',
data:{
labels:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
datasets:[{
label:'Portfolio',
data:[980,1020,990,1100,1150,1120,1210,1280,1240,1310,1420,1485],
borderColor:'#10b981',
backgroundColor:'rgba(16,185,129,0.2)',
borderWidth:3,
fill:true,
tension:0.4
}]
},
options:{
responsive:true,
plugins:{legend:{display:false}}
}
});

// ===============================
// ASSET ALLOCATION
// ===============================
const ctxAllocation = document.getElementById('allocationChart').getContext('2d');

new Chart(ctxAllocation,{
type:'doughnut',
data:{
labels:['TCS','HDFC BANK','RELIANCE'],
datasets:[{
data:[55,25,12],
backgroundColor:['#10b981','#3b82f6','#f59e0b'],
borderWidth:2,
borderColor:'#ffffff',
cutout:'70%'
}]
},
options:{
responsive:true,
plugins:{legend:{display:false}}
}
});

// ===============================
// AI PORTFOLIO ANALYSIS (CORS FIX + TABLE FORMAT)
// ===============================
async function fetchPortfolioAnalysis(){

document.getElementById("aiPredictionResult").innerHTML =
"<p class='text-slate-400'>Fetching AI prediction...</p>";

try{

const response = await fetch(
"https://corsproxy.io/?https://ai-models-ahs6.onrender.com/portfolio-analysis",
{
method:"POST",
headers:{
"Content-Type":"application/json"
},
body:JSON.stringify({
portfolio:{
"TCS.NS":0.3,
"HDFCBANK.NS":0.3,
"RELIANCE.NS":0.4
}
})
}
);

if(!response.ok){
throw new Error("Server Error: " + response.status);
}

const data = await response.json();

let tableRows = "";

for(const key in data){
tableRows += `
<tr class="border-b">
<td class="py-3 px-4 font-medium text-slate-600">${key}</td>
<td class="py-3 px-4 text-slate-800">${data[key]}</td>
</tr>
`;
}

document.getElementById("aiPredictionResult").innerHTML = `
<div class="overflow-x-auto">
<table class="min-w-full text-sm text-left border border-slate-200 rounded-lg overflow-hidden">
<thead class="bg-slate-100">
<tr>
<th class="py-3 px-4 font-semibold text-slate-600">Metric</th>
<th class="py-3 px-4 font-semibold text-slate-600">Value</th>
</tr>
</thead>
<tbody>
${tableRows}
</tbody>
</table>
</div>
`;

}catch(error){

document.getElementById("aiPredictionResult").innerHTML =
`
<div class="bg-red-50 p-4 rounded-lg">
<p class="text-red-600 font-semibold">API Error</p>
<p class="text-sm text-red-500">${error.message}</p>
</div>
`;
}
}

// Auto load on page open
fetchPortfolioAnalysis();
</script>

</body>
</html>